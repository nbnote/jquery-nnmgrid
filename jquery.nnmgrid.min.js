/*!
 * jQuery.nnmGrid
 *
 * @version 0.4
 * @author Kazuhiro Shintani
 * @license MIT License (https://github.com/nbnote/jquery-nnmgrid/blob/master/LICENSE)
 * @link https://github.com/nbnote/jquery-nnmgrid
 */

;(function($,r,s,t){var u='nnmGrid';var v={gap:5,isHover:'is-hover',itemWidth:150,itemHeight:150,itemSelector:'.item',onHover:function(){},onClick:function(){}};var w=function(a,b,c,d){var e=(a.x-b.x)*(c.y-a.y)+(a.y-b.y)*(a.x-c.x);var f=(a.x-b.x)*(d.y-a.y)+(a.y-b.y)*(a.x-d.x);return e*f<0};var z=function(a,b,c,d){if((a.x-c.x)*(a.y-b.y)===(a.x-b.x)*(a.y-c.y))return false;else if(w(a,b,d,c))return false;else if(w(a,c,d,b))return false;else if(w(b,c,d,a))return false;else return true};var A={_init:function(c,d){this.options=$.extend({},v,d);this.$element=c;this.$element.data(u,this);var e=this;var f=this.options;var g=this.$element;this.hovered=-1;this.width=0;this.numCols=0;this.numItems=0;this.itemList=[];this.childList=[];g.css({position:'relative'}).find(f.itemSelector).each(function(a,b){e.childList[a]=$(b).children().css({cursor:'default'}).on('click',$.proxy(e._onClick,e))});$(s).on('mousemove',$.proxy(this._onMouseMove,this));this._draw()},update:function(){this.width=this.$element.width();this._draw()},_onMouseMove:function(e){var a=this.options;var b=this._getIdFromPoint(e.pageX,e.pageY);if(this.hovered!==-1&&this.hovered!==b){this.itemList[this.hovered].removeClass(a.isHover).css({zIndex:99998});this.childList[this.hovered].css({cursor:'default'});this.hovered=-1}if(b!==-1&&b!==this.hovered){this.hovered=b;this.itemList[this.hovered].addClass(a.isHover).css({zIndex:99999});this.childList[this.hovered].css({cursor:'pointer'});a.onHover.call(this.itemList[this.hovered][0])}},_onClick:function(e){var a=this._getIdFromPoint(e.pageX,e.pageY);if(a!==-1){this.options.onClick.call(this.itemList[a][0])}else{e.preventDefault()}},_draw:function(){var c=this;var d=this.$element;var e=this.options;this.width=d.width();this.itemList=[];d.find(e.itemSelector).each(function(a,b){c.itemList[a]=$(b)});this.numItems=this.itemList.length;var f=e.itemWidth+(e.gap*2);this.numCols=Math.floor(this.width/f)+1;if(f*this.numCols-(e.gap*2)>this.width){this.numCols-=1}this.numRows=Math.ceil(this.numItems/this.numCols);var i=this.numItems;var g=Math.floor(e.itemWidth/2);var j=Math.floor(e.itemHeight/2);var n=this.numCols*2-1;for(;i--;){var k=i+Math.floor(i/n);var l=k%this.numCols;var m=Math.floor(k/this.numCols);var o=m%2===1?g:0;var p=l*(e.gap*2);if(o!==0){p+=e.gap}var q=this.itemList[i];q.css({position:'absolute',top:j*m+(m*e.gap),left:e.itemWidth*l+o+p})}var h=this.numRows*(e.itemHeight+e.gap)-(((e.itemHeight+e.gap)/2)*(this.numRows-1));d.height(h)},_getIdFromPoint:function(x,y){var a=this.options;var b=a.itemWidth;var c=a.itemHeight;var d=b/2;var e=c/2;var i=this.itemList.length;var f={x:x,y:y};for(;i--;){var g=this.itemList[i];var h=false;var k=g.offset();var l=Math.floor(k.left);var m=Math.floor(k.top);if(x>l&&x<=l+b&&y>m&&y<=m+c){var j=4;for(;j--;){var n={x:l,y:m+e};var o={x:l+d,y:m+e};var p={x:l+d,y:m};switch(j){case 1:n.x=l+b;break;case 2:p.y=m+c;break;case 3:n.x=l+b;p.y=m+c;break;default:break}if(z(n,o,p,f)){h=true}}}if(h)return i}return-1}};$[u]=function(){};$.extend($[u].prototype,A);$.fn[u]=function(a){if(A[a]&&a.charAt(0)!=='_'){var b=arguments;if(a.substr(0,3)==='get'){return A[a].apply($(this).data(u),Array.prototype.slice.call(b,1))}else{return this.each(function(){A[a].apply($(this).data(u),Array.prototype.slice.call(b,1))})}}else if(typeof a==='object'||!a){return this.each(function(){new $[u]()._init($(this),a)})}else{$.error('Method '+a+' does not exist on jQuery.'+u)}}})(jQuery,window,document);

